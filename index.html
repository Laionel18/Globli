<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Globli: El Regreso</title>
    <style>
        :root {
            --primary: #4ECDC4;
            --accent: #FF6B6B;
            --dark: #2C3E50;
            --globli-skin: #00A896;
        }

        * { box-sizing: border-box; user-select: none; touch-action: manipulation; }
        
        body {
            margin: 0; padding: 0;
            font-family: 'Arial', sans-serif;
            background: #222;
            height: 100vh;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }

        #app {
            width: 100%; max-width: 450px; height: 100%; max-height: 850px;
            background: #e0f7fa;
            position: relative; display: flex; flex-direction: column;
            overflow: hidden; border: 4px solid #333;
        }

        /* --- UI de Estados --- */
        .stats-panel {
            background: rgba(255,255,255,0.9);
            padding: 10px; border-bottom: 2px solid #ccc;
            display: grid; grid-template-columns: 1fr 1fr; gap: 5px;
            z-index: 100;
        }
        .stat-item { display: flex; align-items: center; gap: 5px; font-size: 12px; font-weight: bold; }
        .bar-bg { flex: 1; height: 12px; background: #eee; border-radius: 6px; overflow: hidden; border: 1px solid #ddd; }
        .bar-fill { height: 100%; width: 100%; transition: width 0.3s; }

        .currency {
            position: absolute; top: 70px; right: 10px;
            background: gold; padding: 5px 15px; border-radius: 20px;
            font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 90;
        }

        /* --- Escenario --- */
        #stage {
            flex: 1; position: relative;
            display: flex; justify-content: center; align-items: center;
            transition: background 0.5s;
        }

        /* GLOBILI */
        #globli-container { position: relative; z-index: 10; transition: transform 0.3s; }
        
        #globli {
            width: 160px; height: 160px;
            background: radial-gradient(circle at 30% 30%, #40E0D0, var(--globli-skin));
            border-radius: 50% 50% 45% 45%;
            position: relative;
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.2), 0 10px 20px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .eyes { position: absolute; top: 40px; width: 100%; display: flex; justify-content: center; gap: 20px; }
        .eye { width: 35px; height: 40px; background: white; border-radius: 50%; position: relative; }
        .pupil { width: 15px; height: 15px; background: #222; border-radius: 50%; position: absolute; top: 15px; left: 10px; }
        .mouth { 
            width: 30px; height: 15px; border-bottom: 4px solid #222; 
            border-radius: 0 0 15px 15px; position: absolute; bottom: 40px; left: 65px; 
        }

        /* Modificadores Visuales */
        .dirty { filter: sepia(0.5) saturate(1.5); }
        .dirty::after {
            content: 'üí©'; position: absolute; top: -20px; right: -20px; font-size: 30px;
        }
        .sad .mouth { border-bottom: none; border-top: 4px solid #222; border-radius: 15px 15px 0 0; transform: translateY(5px); }
        .sleeping .eye { height: 4px; background: #333; margin-top: 20px; }
        .sleeping .pupil { display: none; }

        /* --- Herramientas e Interactivos --- */
        .room-controls {
            position: absolute; bottom: 20px; width: 100%;
            display: flex; justify-content: center; gap: 20px; z-index: 50;
        }
        .tool {
            width: 60px; height: 60px; background: white; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 30px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            touch-action: none;
        }

        /* --- Navegaci√≥n --- */
        .nav {
            display: grid; grid-template-columns: repeat(4, 1fr);
            background: white; border-top: 2px solid #ddd;
        }
        .nav-btn {
            padding: 15px 5px; border: none; background: none;
            cursor: pointer; display: flex; flex-direction: column; align-items: center;
            font-size: 20px; opacity: 0.6;
        }
        .nav-btn.active { opacity: 1; color: var(--primary); background: #f9f9f9; }
        .nav-btn span { font-size: 10px; text-transform: uppercase; font-weight: bold; margin-top: 4px; }

        /* --- Modales --- */
        .modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 1000; display: none;
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; width: 85%; border-radius: 20px; padding: 20px;
            text-align: center; max-height: 70%; overflow-y: auto;
        }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .card { border: 2px solid #eee; padding: 10px; border-radius: 10px; cursor: pointer; }

        /* --- Minijuego --- */
        #game-canvas {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0;
            pointer-events: none; display: none;
        }
        .target { 
            position: absolute; width: 50px; height: 50px; background: var(--accent);
            border-radius: 50%; pointer-events: auto; cursor: pointer;
            display: flex; justify-content: center; align-items: center; color: white;
        }

        /* --- Animaciones --- */
        @keyframes float { 0% { transform: translateY(0); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0); } }
        .floating { animation: float 2s infinite ease-in-out; }
        
    </style>
</head>
<body>

<div id="app">
    <div class="stats-panel">
        <div class="stat-item">‚ù§Ô∏è <div class="bar-bg"><div id="bar-hp" class="bar-fill" style="background:#ff4757"></div></div></div>
        <div class="stat-item">üçï <div class="bar-bg"><div id="bar-hg" class="bar-fill" style="background:#ffa502"></div></div></div>
        <div class="stat-item">üßº <div class="bar-bg"><div id="bar-hy" class="bar-fill" style="background:#2e97ff"></div></div></div>
        <div class="stat-item">‚ö° <div class="bar-bg"><div id="bar-en" class="bar-fill" style="background:#2ed573"></div></div></div>
    </div>

    <div class="currency">üí∞ <span id="coins">100</span></div>

    <div id="stage">
        <div id="game-canvas"></div>
        
        <div id="globli-container" class="floating">
            <div id="globli">
                <div class="eyes">
                    <div class="eye"><div class="pupil"></div></div>
                    <div class="eye"><div class="pupil"></div></div>
                </div>
                <div class="mouth"></div>
            </div>
        </div>

        <div id="room-extras" class="room-controls"></div>
    </div>

    <div class="nav">
        <button class="nav-btn active" onclick="game.changeRoom('sala', this)">üè†<span>Sala</span></button>
        <button class="nav-btn" onclick="game.changeRoom('cocina', this)">üç≥<span>Cocina</span></button>
        <button class="nav-btn" onclick="game.changeRoom('ba√±o', this)">üõÅ<span>Ba√±o</span></button>
        <button class="nav-btn" onclick="game.changeRoom('cuarto', this)">üåô<span>Cuarto</span></button>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content" id="modal-inner"></div>
    </div>
</div>

<script>
    const game = {
        // Datos del estado
        hp: 100, hg: 80, hy: 100, en: 100, coins: 100,
        room: 'sala',
        isSleeping: false,
        inventory: { pizza: 1, manzana: 2, burger: 0 },
        
        init() {
            this.updateUI();
            this.startLoop();
            this.changeRoom('sala', document.querySelector('.nav-btn'));
            
            // Hacer interactivo a Globli (Acariciar)
            document.getElementById('globli').onclick = () => {
                if(this.isSleeping) return;
                this.hp = Math.min(100, this.hp + 2);
                this.updateUI();
                this.animateGlobli('scale(1.1)');
            };
        },

        startLoop() {
            setInterval(() => {
                if(this.isSleeping) {
                    this.en = Math.min(100, this.en + 5);
                    this.hg -= 0.5;
                } else {
                    this.hg -= 1;
                    this.hy -= 0.5;
                    this.en -= 0.5;
                }
                
                if(this.hg < 20 || this.hy < 20 || this.en < 20) this.hp -= 1;
                
                this.updateUI();
            }, 3000);
        },

        updateUI() {
            document.getElementById('bar-hp').style.width = this.hp + '%';
            document.getElementById('bar-hg').style.width = this.hg + '%';
            document.getElementById('bar-hy').style.width = this.hy + '%';
            document.getElementById('bar-en').style.width = this.en + '%';
            document.getElementById('coins').innerText = this.coins;

            const g = document.getElementById('globli');
            g.className = '';
            if(this.hy < 40) g.classList.add('dirty');
            if(this.hg < 40 || this.hp < 40) g.parentElement.classList.add('sad'); else g.parentElement.classList.remove('sad');
            if(this.isSleeping) g.parentElement.classList.add('sleeping'); else g.parentElement.classList.remove('sleeping');
        },

        changeRoom(roomName, btn) {
            this.room = roomName;
            
            // Actualizar botones nav
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const stage = document.getElementById('stage');
            const extras = document.getElementById('room-extras');
            extras.innerHTML = '';
            document.getElementById('game-canvas').style.display = 'none';

            if(roomName === 'sala') {
                stage.style.background = "#e0f7fa";
                extras.innerHTML = '<button class="tool" onclick="game.startMiniGame()">üéÆ</button>';
                extras.innerHTML += '<button class="tool" onclick="game.openShop()">üõí</button>';
            } 
            else if(roomName === 'cocina') {
                stage.style.background = "#fff9c4";
                extras.innerHTML = '<button class="tool" onclick="game.openFridge()">‚ùÑÔ∏è</button>';
            } 
            else if(roomName === 'ba√±o') {
                stage.style.background = "#e3f2fd";
                extras.innerHTML = '<div class="tool" id="soap" onmousedown="game.drag(event, \'soap\')" ontouchstart="game.drag(event, \'soap\')">üßº</div>';
                extras.innerHTML += '<div class="tool" id="shower" onmousedown="game.drag(event, \'shower\')" ontouchstart="game.drag(event, \'shower\')">üöø</div>';
            } 
            else if(roomName === 'cuarto') {
                stage.style.background = this.isSleeping ? "#1a237e" : "#f3e5f5";
                extras.innerHTML = `<button class="tool" onclick="game.toggleSleep()">${this.isSleeping ? 'üí°' : 'üí§'}</button>`;
            }
        },

        // --- FUNCIONES DE COMIDA ---
        openFridge() {
            let html = '<h2>Mi Nevera</h2><div class="grid">';
            for(let item in this.inventory) {
                if(this.inventory[item] > 0) {
                    html += `<div class="card" onclick="game.eat('${item}')">
                                <div style="font-size:30px">${this.getIcon(item)}</div>
                                <p>${item} (${this.inventory[item]})</p>
                             </div>`;
                }
            }
            html += '</div><button onclick="game.closeModal()" style="margin-top:20px">Cerrar</button>';
            this.showModal(html);
        },

        eat(item) {
            if(this.inventory[item] > 0) {
                this.inventory[item]--;
                this.hg = Math.min(100, this.hg + 20);
                this.hp = Math.min(100, this.hp + 5);
                this.animateGlobli('translateY(-20px) scale(1.1)');
                this.closeModal();
                this.updateUI();
            }
        },

        openShop() {
            const items = [
                {id: 'pizza', p: 20, icon: 'üçï'},
                {id: 'manzana', p: 5, icon: 'üçé'},
                {id: 'burger', p: 15, icon: 'üçî'}
            ];
            let html = '<h2>Tienda de Comida</h2><div class="grid">';
            items.forEach(i => {
                html += `<div class="card" onclick="game.buy('${i.id}', ${i.p})">
                            <div style="font-size:30px">${i.icon}</div>
                            <p>${i.p} monedas</p>
                         </div>`;
            });
            html += '</div><button onclick="game.closeModal()" style="margin-top:20px">Cerrar</button>';
            this.showModal(html);
        },

        buy(id, price) {
            if(this.coins >= price) {
                this.coins -= price;
                this.inventory[id] = (this.inventory[id] || 0) + 1;
                this.updateUI();
                alert('¬°Comprado!');
            } else {
                alert('No tienes dinero');
            }
        },

        // --- MECANICAS ---
        toggleSleep() {
            this.isSleeping = !this.isSleeping;
            this.changeRoom('cuarto', document.querySelector('button[onclick*="cuarto"]'));
            this.updateUI();
        },

        drag(e, type) {
            const tool = e.target;
            const move = (ev) => {
                const x = ev.touches ? ev.touches[0].clientX : ev.clientX;
                const y = ev.touches ? ev.touches[0].clientY : ev.clientY;
                tool.style.position = 'fixed';
                tool.style.left = (x - 30) + 'px';
                tool.style.top = (y - 30) + 'px';

                // Colisi√≥n con Globli
                const gRect = document.getElementById('globli').getBoundingClientRect();
                if(x > gRect.left && x < gRect.right && y > gRect.top && y < gRect.bottom) {
                    if(type === 'soap') { this.hy = Math.min(100, this.hy + 1); }
                    if(type === 'shower') { this.hy = Math.min(100, this.hy + 2); }
                    this.updateUI();
                }
            };
            const stop = () => {
                window.onmousemove = window.ontouchmove = null;
                this.changeRoom('ba√±o', document.querySelector('button[onclick*="ba√±o"]'));
            };
            window.onmousemove = window.ontouchmove = move;
            window.onmouseup = window.ontouchend = stop;
        },

        startMiniGame() {
            const canvas = document.getElementById('game-canvas');
            canvas.style.display = 'block';
            canvas.innerHTML = '';
            let score = 0;
            
            const spawn = () => {
                if(score >= 5) {
                    canvas.style.display = 'none';
                    this.coins += 20;
                    this.updateUI();
                    alert('¬°Ganaste 20 monedas!');
                    return;
                }
                const t = document.createElement('div');
                t.className = 'target';
                t.innerText = '‚ö°';
                t.style.left = Math.random() * 80 + '%';
                t.style.top = Math.random() * 80 + '%';
                t.onclick = () => { t.remove(); score++; spawn(); };
                canvas.appendChild(t);
            };
            spawn();
        },

        // --- HELPERS ---
        showModal(html) {
            const m = document.getElementById('modal');
            document.getElementById('modal-inner').innerHTML = html;
            m.style.display = 'flex';
        },
        closeModal() { document.getElementById('modal').style.display = 'none'; },
        getIcon(id) {
            return id === 'pizza' ? 'üçï' : id === 'manzana' ? 'üçé' : 'üçî';
        },
        animateGlobli(trans) {
            const g = document.getElementById('globli');
            g.style.transform = trans;
            setTimeout(() => g.style.transform = 'scale(1)', 200);
        }
    };

    game.init();
</script>

</body>
</html>
